---
import '../styles/index.css';
import { getLangFromUrl, useTranslations } from '../i18n/utils';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const API_URL = import.meta.env.PUBLIC_API_URL || 'http://localhost:8000';
let galleries = [];
let navLabels = {};

try {
	const response = await fetch(`${API_URL}/api/galleries`);
	if (response.ok) {
		galleries = await response.json();
	}

	const settingsResponse = await fetch(`${API_URL}/api/settings`);
	if (settingsResponse.ok) {
		const data = await settingsResponse.json();
		if (lang === 'en') {
			navLabels = {
				works: data.nav_works_en,
				philosophy: data.nav_philosophy_en,
				exhibitions: data.nav_exhibitions_en,
				contact: data.nav_contact_en,
				inquire: data.nav_inquire_en,
			};
		} else {
			navLabels = {
				works: data.nav_works_cz,
				philosophy: data.nav_philosophy_cz,
				exhibitions: data.nav_exhibitions_cz,
				contact: data.nav_contact_cz,
				inquire: data.nav_inquire_cz,
			};
		}
	}
} catch (e) {
	console.error('Failed to fetch data', e);
}
---

<html lang={lang}>
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>Galleries | Alex Carter</title>
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
	</head>
	<body>
		<header class="container" style="padding: 2rem 0; display: flex; justify-content: space-between; align-items: center;">
			<a href="/" style="font-weight: 700; font-size: 1.5rem; text-decoration: none; color: inherit;">AC.</a>
			<nav style="display: flex; gap: 1rem; align-items: center;">
                <a href="/" style="color: var(--text-muted); text-decoration: none; font-size: 0.9rem; font-weight: 500;">{navLabels.works || 'Home'}</a>
				<a href="/admin" class="btn glass" style="font-size: 0.9rem; padding: 0.5rem 1rem;">{t('nav.admin')}</a>
			</nav>
		</header>

		<main class="container section">
			<h1 style="text-align: center; margin-bottom: 4rem;">Galleries</h1>
			
			<div style="display: flex; flexDirection: column; gap: 6rem;">
				{galleries.length === 0 ? (
					<p style="text-align: center; color: var(--text-muted);">No galleries found.</p>
				) : (
					galleries.map(gallery => (
						<article class="fade-in">
							<h2 style="margin-bottom: 2rem; border-left: 4px solid var(--primary); padding-left: 1rem;">{gallery.title}</h2>
							<div class="grid">
								{gallery.images && gallery.images.map(img => (
									<div class="card glass" style="padding: 0; overflow: hidden; height: 300px;">
										<img 
											src={`${API_URL}${img.url}`} 
											alt={img.filename} 
											style="width: 100%; height: 100%; object-fit: cover; display: block;"
										/>
									</div>
								))}
							</div>
						</article>
					))
				)}
			</div>
		</main>

		<footer class="container" style="padding: 4rem 0; border-top: 1px solid var(--glass-border); display: flex; justify-content: space-between; align-items: center; color: var(--text-muted); font-size: 0.9rem;">
			<p>&copy; 2026 Alex Carter. {t('footer.rights')}</p>
		</footer>
	</body>
</html>
