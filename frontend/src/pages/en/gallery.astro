---
import Layout from '../../layouts/Layout.astro';
import Navigation from '../../components/Navigation.astro';
import Footer from '../../components/Footer.astro';
import { getLangFromUrl, useTranslations } from '../../i18n/utils';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const API_URL = import.meta.env.PUBLIC_API_URL || 'http://localhost:8000';
let galleries = [];
let navLabels = {};

try {
	const response = await fetch(`${API_URL}/api/galleries`);
	if (response.ok) {
		galleries = await response.json();
	}

	const settingsResponse = await fetch(`${API_URL}/api/settings`);
	if (settingsResponse.ok) {
		const data = await settingsResponse.json();
		navLabels = {
			works: data.nav_works_en,
			philosophy: data.nav_philosophy_en,
			exhibitions: data.nav_exhibitions_en,
			contact: data.nav_contact_en,
			inquire: data.nav_inquire_en,
		};
	}
} catch (e) {
	console.error('Failed to fetch data', e);
}
---

<Layout title="Galleries | ELARA.VO">
    <div class="relative flex min-h-screen w-full flex-col">
        <Navigation navLabels={navLabels} />
        
        <main class="flex-grow pt-32 pb-20 px-6 md:px-12 max-w-[1400px] mx-auto w-full">
            <div class="mb-16">
                <h1 class="text-4xl md:text-5xl font-bold mb-4">{t('projects.title')}</h1>
                <p class="text-slate-500 dark:text-slate-400">Curated collections and series.</p>
            </div>
            
            <div class="space-y-24">
                {galleries.length === 0 ? (
                    <div class="py-20 text-center">
                        <p class="text-slate-500">No galleries found yet.</p>
                    </div>
                ) : (
                    galleries.map(gallery => (
                        <article class="group">
                            <div class="flex items-center gap-4 mb-8">
                                <div class="h-px w-12 bg-primary"></div>
                                <h2 class="text-2xl font-bold uppercase tracking-widest">{gallery.title}</h2>
                                <span class="text-xs text-slate-500 font-medium">({gallery.images?.length || 0} pieces)</span>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                                {gallery.images && gallery.images.slice(0, 6).map((img, index) => (
                                    <a href={`/en/item/${gallery.id}/${index}`} 
                                       class="relative aspect-[4/5] overflow-hidden rounded-xl bg-slate-900 group/item">
                                        <img 
                                            src={`${API_URL}${img.url}`} 
                                            alt={img.filename} 
                                            class="w-full h-full object-cover grayscale hover:grayscale-0 transition-all duration-700 scale-100 group-hover/item:scale-105"
                                        />
                                        <div class="absolute inset-0 bg-black/40 opacity-0 group-hover/item:opacity-100 transition-opacity flex items-end p-6">
                                            <p class="text-white font-medium text-sm">View Detail</p>
                                        </div>
                                    </a>
                                ))}
                            </div>
                            
                            {gallery.images && gallery.images.length > 6 && (
                                <div class="mt-8 flex justify-end">
                                    <a href={`/en/item/${gallery.id}/0`} 
                                       class="text-xs font-bold uppercase tracking-widest text-slate-500 hover:text-primary transition-colors flex items-center gap-2">
                                        Explore full gallery
                                        <span class="material-symbols-outlined text-sm">trending_flat</span>
                                    </a>
                                </div>
                            )}
                        </article>
                    ))
                )}
            </div>
        </main>
        
        <Footer />
    </div>
</Layout>
